<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ZeitPlan">
    <title>Zeit & Urlaub Tracker</title>

    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --input-bg: #2c2c2e;
            --text-main: #ffffff;
            --text-secondary: #8e8e93;
            --accent: #0A84FF; /* iOS Blau */
            --danger: #FF453A; /* Rot f√ºr Abgang */
            --success: #30D158; /* Gr√ºn f√ºr Zugang */
            --border: #38383a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Header --- */
        header {
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: 10px;
            background-color: var(--bg-color);
            text-align: center;
            border-bottom: 1px solid var(--border);
            z-index: 10;
        }
        header h1 { margin: 10px 0 5px; font-size: 20px; font-weight: 600; }

        /* --- Main Content --- */
        main {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 100px; /* Platz f√ºr Tab Bar */
        }

        /* --- Views (Tabs) --- */
        .view { display: none; }
        .view.active { display: block; }

        /* --- Form Elements --- */
        .form-group { margin-bottom: 20px; }
        label { display: block; color: var(--text-secondary); font-size: 13px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        input, select {
            width: 100%;
            background-color: var(--input-bg);
            border: none;
            color: white;
            padding: 16px;
            border-radius: 12px;
            font-size: 17px;
            box-sizing: border-box;
            -webkit-appearance: none; /* iOS Reset */
        }

        /* Segmented Control (Switch) */
        .segmented-control {
            display: flex;
            background-color: var(--input-bg);
            border-radius: 9px;
            padding: 2px;
            margin-bottom: 25px;
        }
        .segment-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 7px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .segment-btn.active {
            background-color: #636366;
            color: white;
        }
        /* Farben f√ºr den Switch */
        .segment-btn[data-value="taken"].active { background-color: var(--danger); }
        .segment-btn[data-value="earned"].active { background-color: var(--success); }

        .row { display: flex; gap: 15px; }
        .col { flex: 1; }

        button.save-btn {
            background-color: var(--accent);
            color: white;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* --- History List --- */
        .entry-card {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .entry-info h3 { margin: 0 0 5px; font-size: 16px; }
        .entry-info p { margin: 0; color: var(--text-secondary); font-size: 13px; }
        .entry-value { font-weight: 700; font-size: 16px; }
        .entry-value.taken { color: var(--danger); }
        .entry-value.earned { color: var(--success); }
        
        .delete-btn {
            background: none; border: none; color: var(--text-secondary); font-size: 12px; margin-top: 5px;
        }

        /* --- Dashboard Stats --- */
        .stat-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .stat-label { font-size: 15px; font-weight: 500; }
        .stat-number { font-size: 20px; font-weight: 700; color: var(--accent); }

        /* --- Tab Bar --- */
        nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            background-color: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding-bottom: env(safe-area-inset-bottom);
            padding-top: 10px;
            height: 55px;
        }
        .nav-item {
            text-align: center;
            color: var(--text-secondary);
            font-size: 10px;
            width: 60px;
        }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--accent); }

    </style>
</head>
<body>

    <header>
        <h1 id="page-title">Neuer Eintrag</h1>
    </header>

    <main>
        <div id="view-add" class="view active">
            
            <div class="segmented-control">
                <div class="segment-btn active" data-value="taken" onclick="setType('taken')">Genommen (-)</div>
                <div class="segment-btn" data-value="earned" onclick="setType('earned')">Erhalten (+)</div>
            </div>

            <div class="form-group">
                <label>Kategorie</label>
                <select id="category">
                    <option value="Urlaub">Urlaub</option>
                    <option value="Stunden">Stunden / √úberstunden</option>
                    <option value="Kindkrank">Kindkrank</option>
                    <option value="DA">DA (Dienstausgleich)</option>
                    <option value="Langzeitkonto">Langzeitkonto</option>
                    <option value="Sonderurlaub">Sonderurlaub</option>
                </select>
            </div>

            <div class="form-group">
                <label>Datum</label>
                <input type="date" id="date">
            </div>

            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label>Von</label>
                        <input type="time" id="time-start" value="08:00">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Bis</label>
                        <input type="time" id="time-end" value="16:30">
                    </div>
                </div>
            </div>

            <button class="save-btn" onclick="addEntry()">Speichern</button>
        </div>

        <div id="view-list" class="view">
            <div id="entries-container">
                <p style="text-align:center; color: #555; margin-top: 50px;">Noch keine Eintr√§ge.</p>
            </div>
            <button onclick="clearAllData()" style="margin-top:30px; width:100%; background:none; border:1px solid #333; color:#555; padding:10px; border-radius:10px;">Alles l√∂schen (Reset)</button>
        </div>

        <div id="view-stats" class="view">
            <h2 style="font-size:14px; color:#666; text-transform:uppercase; margin-bottom:15px;">Summen (Stunden)</h2>
            <div id="stats-container">
                </div>
        </div>
    </main>

    <nav>
        <div class="nav-item active" onclick="switchView('view-add', this, 'Neuer Eintrag')">
            <span class="nav-icon">‚ûï</span>
            Eingabe
        </div>
        <div class="nav-item" onclick="switchView('view-list', this, 'Verlauf')">
            <span class="nav-icon">üìÖ</span>
            Verlauf
        </div>
        <div class="nav-item" onclick="switchView('view-stats', this, 'Statistik')">
            <span class="nav-icon">üìä</span>
            Statistik
        </div>
    </nav>

    <script>
        // --- LOGIK ---

        let entries = JSON.parse(localStorage.getItem('myWorkData')) || [];
        let currentType = 'taken'; // 'taken' (genommen) or 'earned' (erhalten)

        // Init beim Laden
        window.addEventListener('load', () => {
            document.getElementById('date').valueAsDate = new Date();
            renderList();
            renderStats();
        });

        // Typ umschalten
        function setType(type) {
            currentType = type;
            document.querySelectorAll('.segment-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.segment-btn[data-value="${type}"]`).classList.add('active');
        }

        // Eintrag speichern
        function addEntry() {
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;
            const start = document.getElementById('time-start').value;
            const end = document.getElementById('time-end').value;

            if(!date || !start || !end) {
                alert("Bitte Datum und Zeiten ausf√ºllen.");
                return;
            }

            // Dauer berechnen
            const duration = calculateDuration(start, end);
            
            const entry = {
                id: Date.now(),
                type: currentType,
                category,
                date,
                start,
                end,
                duration
            };

            entries.unshift(entry); // Neuen Eintrag an den Anfang
            localStorage.setItem('myWorkData', JSON.stringify(entries));

            alert('Gespeichert!');
            renderList();
            renderStats();
        }

        // Zeitdifferenz berechnen in Stunden (Dezimal)
        function calculateDuration(start, end) {
            const s = start.split(':');
            const e = end.split(':');
            const startMin = parseInt(s[0]) * 60 + parseInt(s[1]);
            const endMin = parseInt(e[0]) * 60 + parseInt(e[1]);
            
            let diff = endMin - startMin;
            if (diff < 0) diff += 24 * 60; // Falls √ºber Mitternacht (simpel)
            
            return (diff / 60).toFixed(2); // z.B. 4.50 Stunden
        }

        // Liste anzeigen
        function renderList() {
            const container = document.getElementById('entries-container');
            container.innerHTML = '';

            if (entries.length === 0) {
                container.innerHTML = '<p style="text-align:center; color: #555; margin-top: 50px;">Keine Eintr√§ge vorhanden.</p>';
                return;
            }

            entries.forEach(entry => {
                const isTaken = entry.type === 'taken';
                const sign = isTaken ? '-' : '+';
                const colorClass = isTaken ? 'taken' : 'earned';
                
                // Datum sch√∂n formatieren
                const dateObj = new Date(entry.date);
                const dateStr = dateObj.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit'});

                const html = `
                <div class="entry-card">
                    <div class="entry-info">
                        <h3>${entry.category}</h3>
                        <p>${dateStr} | ${entry.start} - ${entry.end} Uhr</p>
                        <button class="delete-btn" onclick="deleteEntry(${entry.id})">L√∂schen</button>
                    </div>
                    <div class="entry-value ${colorClass}">
                        ${sign} ${entry.duration} h
                    </div>
                </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        // Statistik anzeigen
        function renderStats() {
            const container = document.getElementById('stats-container');
            const categories = ["Urlaub", "Stunden", "Kindkrank", "DA", "Langzeitkonto", "Sonderurlaub"];
            
            let html = '';

            categories.forEach(cat => {
                // Filter f√ºr die Kategorie
                const catEntries = entries.filter(e => e.category === cat);
                
                let total = 0;
                catEntries.forEach(e => {
                    const val = parseFloat(e.duration);
                    if (e.type === 'earned') total += val;
                    else total -= val;
                });

                // Farbe basierend auf Positiv/Negativ
                const color = total >= 0 ? 'var(--success)' : 'var(--danger)';
                const displayTotal = total.toFixed(2);

                html += `
                <div class="stat-card">
                    <span class="stat-label">${cat}</span>
                    <span class="stat-number" style="color: ${color}">${displayTotal} h</span>
                </div>
                `;
            });

            container.innerHTML = html;
        }

        // Eintrag l√∂schen
        function deleteEntry(id) {
            if(confirm('Eintrag wirklich l√∂schen?')) {
                entries = entries.filter(e => e.id !== id);
                localStorage.setItem('myWorkData', JSON.stringify(entries));
                renderList();
                renderStats();
            }
        }

        // Alles l√∂schen
        function clearAllData() {
            if(confirm('ALLES l√∂schen? Das kann nicht r√ºckg√§ngig gemacht werden.')) {
                localStorage.removeItem('myWorkData');
                entries = [];
                renderList();
                renderStats();
            }
        }

        // Tabs umschalten
        function switchView(viewId, navItem, title) {
            // Hide all views
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            // Show selected view
            document.getElementById(viewId).classList.add('active');
            
            // Update Title
            document.getElementById('page-title').innerText = title;

            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            navItem.classList.add('active');
        }
    </script>
</body>
</html>
